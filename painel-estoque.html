<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel de Estoque de Vacinas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --bg: #121212;
      --text: #f1f1f1;
      --highlight: #0d6efd;
    }

    body {
      padding: 2rem;
      background-color: var(--bg);
      color: var(--text);
    }

    .card {
      border-radius: 1rem;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      background-color: #1e1e1e;
      color: var(--text);
      overflow: hidden;
    }

    .card-header {
      font-weight: bold;
      font-size: 1.1rem;
    }

    .card-body.scrollable {
      max-height: 250px;
      overflow-y: auto;
    }

    .card-body.scrollable-lg {
      max-height: 400px;
      overflow-y: auto;
    }

    .btn-3d {
      background-color: var(--highlight);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.3rem 0.8rem;
      font-weight: bold;
      box-shadow: 0 4px #0b5ed7;
      transition: all 0.2s ease-in-out;
      cursor: pointer;
    }

    .btn-3d:hover {
      box-shadow: 0 2px #0a53be;
      transform: translateY(1px);
    }

    .btn-3d:active {
      box-shadow: 0 1px #084298;
      transform: translateY(2px);
    }

    .status-quase td, .status-quase td span {
      animation: blink-yellow 2s infinite;
    }

    .status-vencida td, .status-vencida td span {
      animation: blink-red 2s infinite;
    }

    @keyframes blink-yellow {
      0%, 100% { background-color: #b58e00; }
      50% { background-color: #ffc107; }
    }

    @keyframes blink-red {
      0%, 100% { background-color: #8b1a1a; }
      50% { background-color: #dc3545; }
    }

    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #777;
    }
  </style>
</head>
<body>

  <div class="container-fluid">
    <h2 class="text-center mb-4 text-light">ðŸ“Š Painel de Estoque de Vacinas</h2>

    <div class="row g-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-primary text-white">ðŸ’‰ Vacinas em Uso</div>
          <div class="card-body scrollable-lg">
            <table class="table table-bordered table-hover table-sm mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Vacina</th>
                  <th>Lote</th>
                  <th>LaboratÃ³rio</th>
                  <th>Quantidade</th>
                  <th>Validade</th>
                  <th>Status</th>
                  <th>AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody id="tabela-estoque"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-danger text-white">ðŸš¨ Estoque Baixo</div>
          <div class="card-body scrollable p-0">
            <table class="table table-sm table-striped table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Vacina</th>
                  <th>Lote</th>
                  <th>Quantidade</th>
                </tr>
              </thead>
              <tbody id="tabela-baixo-estoque"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="card">
          <div class="card-header bg-dark text-white">ðŸ“¦ Resumo por Vacina</div>
          <div class="card-body scrollable p-0">
            <table class="table table-sm table-striped mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Vacina</th>
                  <th>Total de Doses</th>
                </tr>
              </thead>
              <tbody id="tabela-resumo"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="descarteModal" tabindex="-1" aria-labelledby="descarteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content text-dark">
        <div class="modal-header">
          <h5 class="modal-title" id="descarteModalLabel">Desprezar Vacina</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          Tem certeza de que deseja desprezar essa vacina? Essa aÃ§Ã£o Ã© irreversÃ­vel.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger">Confirmar Descarte</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function carregarDados() {
      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbwmho4oHFdo0KlwfE7Joyj1Mnou8LAG-hqwG4vnn6E-MMrqjN_rzSArXDS8SQXjNiIcaA/exec"); // â›” Troque pela URL da sua API
        const json = await response.json();

        const tabelaEstoque = document.getElementById("tabela-estoque");
        const tabelaResumo = document.getElementById("tabela-resumo");
        const tabelaBaixo = document.getElementById("tabela-baixo-estoque");

        tabelaEstoque.innerHTML = "";
        tabelaResumo.innerHTML = "";
        tabelaBaixo.innerHTML = "";

        json.data.forEach(item => {
          const linha = document.createElement("tr");

          if (item.status.includes("VENCIDA")) {
            linha.classList.add("status-vencida", "text-white");
          } else if (item.status.includes("QUASE")) {
            linha.classList.add("status-quase", "text-dark");
          }

          linha.innerHTML = `
            <td>${item.vacina}</td>
            <td>${item.lote}</td>
            <td>${item.laboratorio || "-"}</td>
            <td>${item.quantidade}</td>
            <td>${item.validade}</td>
            <td><span class="badge ${item.status.includes('VENCIDA') ? 'bg-danger' : item.status.includes('QUASE') ? 'bg-warning text-dark' : 'bg-success'}">${item.status}</span></td>
            <td><button class="btn-3d" onclick="abrirModal()">Ver</button></td>
          `;
          tabelaEstoque.appendChild(linha);

          if (item.quantidade <= 3) {
            const linhaBaixo = document.createElement("tr");
            linhaBaixo.innerHTML = `
              <td>${item.vacina}</td>
              <td>${item.lote}</td>
              <td>${item.quantidade}</td>
            `;
            tabelaBaixo.appendChild(linhaBaixo);
          }
        });

        json.resumo.forEach(item => {
          const linhaResumo = document.createElement("tr");
          linhaResumo.innerHTML = `
            <td>${item.vacina}</td>
            <td>${item.total}</td>
          `;
          tabelaResumo.appendChild(linhaResumo);
        });
      } catch (e) {
        console.error("Erro ao carregar dados da API:", e);
      }
    }

    function abrirModal() {
      const modal = new bootstrap.Modal(document.getElementById('descarteModal'));
      modal.show();
    }

    document.addEventListener("DOMContentLoaded", carregarDados);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
